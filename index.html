<script>
document.addEventListener("DOMContentLoaded", function() {
    const tg = window.Telegram?.WebApp;
    if (tg) tg.expand();

    // –°–ø–∏—Å–æ–∫ —Ä–∞—Å—Ç–µ–Ω–∏–π –∏ –∏—Ö —Ñ–æ—Ç–æ
    const plants = {
        "Alctromeriya": "images/alctromeriya.png",
        "Begoniya": "images/begoniya.png",
        "Koleus": "images/coleus.png",
        "Gardeniya": "images/gardeniya.png",
        "Orfid Falenopsis": "images/orfid_falenopsis.png",
        "Orfid Kattleya": "images/orfid_kattleya.png"
    };

    // –ü–æ–ª—É—á–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–µ —Ä–∞—Å—Ç–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram start_param –∏–ª–∏ –¥–µ—Ñ–æ–ª—Ç
    const plantFromStart = tg?.initDataUnsafe?.start_param || "Koleus";

    // –ü–æ–¥—Å—Ç–∞–≤–ª—è–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –∫–∞—Ä—Ç–∏–Ω–∫—É
    document.getElementById("plantName").innerText = plantFromStart;
    document.getElementById("plantImage").src = plants[plantFromStart] || "images/coleus.png";

    const waterBtn = document.getElementById("waterBtn");
    const statusText = document.getElementById("statusText");

    const wateringInterval = 3; // –¥–Ω–µ–π
    let lastWatered = localStorage.getItem(`${plantFromStart}-lastWatered`);

    function updateButtonState() {
        const today = new Date();
        if (lastWatered) {
            const last = new Date(lastWatered);
            const diffTime = today - last;
            const diffDays = Math.floor(diffTime / (1000*60*60*24));
            const daysLeft = wateringInterval - diffDays;

            if (daysLeft <= 0) {
                waterBtn.disabled = false;
                waterBtn.style.background = "#2ecc71";
                statusText.innerText = "";
            } else {
                waterBtn.disabled = true;
                waterBtn.style.background = "#ccc";
                statusText.innerText = `–°–ª–µ–¥—É—é—â–∏–π –ø–æ–ª–∏–≤ —á–µ—Ä–µ–∑ ${daysLeft} –¥–Ω.`;
            }
        } else {
            waterBtn.disabled = false;
            waterBtn.style.background = "#2ecc71";
            statusText.innerText = "";
        }
    }

    waterBtn.addEventListener("click", () => {
        const today = new Date().toISOString().slice(0,10);
        localStorage.setItem(`${plantFromStart}-lastWatered`, today);
        lastWatered = today;
        waterBtn.disabled = true;
        waterBtn.style.background = "#ccc";
        statusText.innerText = `–°–ª–µ–¥—É—é—â–∏–π –ø–æ–ª–∏–≤ —á–µ—Ä–µ–∑ ${wateringInterval} –¥–Ω. üå±`;
    });

    updateButtonState();
});
</script>
